document.addEventListener("DOMContentLoaded",()=>{function r(e){var t=e.parentNode.querySelector("input");0<t.value.length?e.style.display="block":e.style.display="none"}function c(e,t,r){e.closest(".popup").classList.add(r),e.innerHTML=t}function o(e){e.classList.remove("error"),e.classList.remove("error-wrapper")}document.querySelectorAll(".input-clear").forEach(t=>{t.parentNode.querySelector("input").addEventListener("input",()=>r(t)),r(t),t.addEventListener("click",()=>{var e;(e=t).parentNode.querySelector("input").value="",r(e)})}),[].forEach.call(document.querySelectorAll("input[type=tel]"),function(e){let s;function t(e){e.keyCode&&(s=e.keyCode),this.selectionStart<3&&e.preventDefault();let t="+7 (___) ___-__-__",r=0,a=t.replace(/\D/g,""),n=this.value.replace(/\D/g,""),l=t.replace(/[_\d]/g,function(e){return r<n.length?n.charAt(r++)||a.charAt(r):e});-1!=(r=l.indexOf("_"))&&(r<5&&(r=3),l=l.slice(0,r));var u=t.substr(0,this.value.length).replace(/_+/g,function(e){return"\\d{1,"+e.length+"}"}).replace(/[+()]/g,"\\$&");(!(u=new RegExp("^"+u+"$")).test(this.value)||this.value.length<5||47<s&&s<58)&&(this.value=l),"blur"==e.type&&this.value.length<5&&(this.value="")}e.addEventListener("input",t,!1),e.addEventListener("focus",t,!1),e.addEventListener("blur",t,!1),e.addEventListener("keydown",t,!1)}),document.querySelectorAll('button[type="submit"]').forEach(e=>{var t,r=e.parentNode,a=document.createElement("div");a.innerHTML=`<input name="trafficSource" type="hidden" value="">
            <input name="istochnik" type="hidden" value="">
            <input name="clientID" type="hidden" value="${t=document.cookie.match("(?:^|;)\\s*_ym_uid=([^;]*)"),!!t&&decodeURIComponent(t[1])}">`,r.appendChild(a),"undefined"!=typeof sbjs&&(sbjs.init(a),r.querySelector("input[name=trafficSource]").value=sbjs.get.current.typ,r.querySelector("input[name=istochnik]").value=sbjs.get.current.src),e.addEventListener("click",async function(e){e.preventDefault(),console.log("testr");var e=this.closest("form"),t=e.dataset.modalOpen,r={success:e.dataset.modalOk,error:e.dataset.modalErr};let a={};e.querySelectorAll('input[type="tel"], textarea, input[type="text"]').forEach(e=>{e.hasAttribute("required")&&(a[e.name]={type:e.type,value:e.value})});r={success:document.querySelector(r.success),error:document.querySelector(r.error)};if((e=>{let t=!0;for(var r in e){var a=e[r];switch(a.type){case"tel":a.value.replace(/\D/g,"").length<11&&(t=!1);break;case"textarea":case"text":(!/[а-яА-ЯёЁ]/.test(a.value)||a.value.trim().length<=2)&&(t=!1);break;default:t=!1}if(!t)break}return t})(a)){var n=this,l=e,u=n.innerText;n.innerHTML="Отправление",n.disabled=!0;try{var s=await fetch("/netcat_template/ajax/request.php",{method:"POST",body:new FormData(l)}),i=await s.text();c(s.ok?r.success:r.error,i,t)}catch(e){c(r.error,e.message,t)}finally{((e,t)=>{e.innerText=t,e.disabled=!1})(n,u)}}else e.querySelectorAll('input[type="tel"], textarea, input[type="text"]').forEach(e=>{o(e);var t=(e=>{let t="";switch(e.type){case"tel":e.value.replace(/\D/g,"").length<11&&(t="Введите верный номер телефона");break;case"textarea":case"text":(!/[а-яА-ЯёЁ]/.test(e.value)||e.value.trim().length<=2)&&(t="Текст должен содержать русские буквы");break;default:t="Поле не заполнено"}return t})(e);t&&((t=e).classList.add("error-wrapper"),t.classList.add("error"),setTimeout(()=>{o(e)},3e3)),e.addEventListener("input",function(){this.value&&o(this)})})}),document.querySelectorAll("input[name='urlMessage'], input[name='title_url_message']").forEach(e=>{e.value="urlMessage"===e.name?window.location.href:document.title})})});
//# sourceMappingURL=request.js.map
