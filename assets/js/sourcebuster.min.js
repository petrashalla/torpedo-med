(e=>{var r;"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?r=window:"undefined"!=typeof global?r=global:"undefined"!=typeof self&&(r=self),r.sbjs=e())})(function(){return function a(n,s,i){function o(t,e){if(!s[t]){if(!n[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(c)return c(t,!0);e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}r=s[t]={exports:{}};n[t][0].call(r.exports,function(e){var r=n[t][1][e];return o(r||e)},r,r.exports,a,n,s,i)}return s[t].exports}for(var c="function"==typeof require&&require,e=0;e<i.length;e++)o(i[e]);return o}({1:[function(e,r){var t=e("./init");r.exports={init:function(e){this.get=t(e),e&&e.callback&&"function"==typeof e.callback&&e.callback(this.get)}}},{"./init":6}],2:[function(e,r){var t=e("./terms"),a=e("./helpers/utils"),n={containers:{current:"sbjs_current",current_extra:"sbjs_current_add",first:"sbjs_first",first_extra:"sbjs_first_add",session:"sbjs_session",udata:"sbjs_udata",promocode:"sbjs_promo"},service:{migrations:"sbjs_migrations"},delimiter:"|||",aliases:{main:{type:"typ",source:"src",medium:"mdm",campaign:"cmp",content:"cnt",term:"trm"},extra:{fire_date:"fd",entrance_point:"ep",referer:"rf"},session:{pages_seen:"pgs",current_page:"cpg"},udata:{visits:"vst",ip:"uip",agent:"uag"},promo:"code"},pack:{main:function(e){return n.aliases.main.type+"="+e.type+n.delimiter+n.aliases.main.source+"="+e.source+n.delimiter+n.aliases.main.medium+"="+e.medium+n.delimiter+n.aliases.main.campaign+"="+e.campaign+n.delimiter+n.aliases.main.content+"="+e.content+n.delimiter+n.aliases.main.term+"="+e.term},extra:function(e){return n.aliases.extra.fire_date+"="+a.setDate(new Date,e)+n.delimiter+n.aliases.extra.entrance_point+"="+document.location.href+n.delimiter+n.aliases.extra.referer+"="+(document.referrer||t.none)},user:function(e,r){return n.aliases.udata.visits+"="+e+n.delimiter+n.aliases.udata.ip+"="+r+n.delimiter+n.aliases.udata.agent+"="+navigator.userAgent},session:function(e){return n.aliases.session.pages_seen+"="+e+n.delimiter+n.aliases.session.current_page+"="+document.location.href},promo:function(e){return n.aliases.promo+"="+a.setLeadingZeroToInt(a.randomInt(e.min,e.max),e.max.toString().length)}}};r.exports=n},{"./helpers/utils":5,"./terms":9}],3:[function(e,r){var u=e("../data").delimiter;r.exports={encodeData:function(e){return encodeURIComponent(e).replace(/\!/g,"%21").replace(/\~/g,"%7E").replace(/\*/g,"%2A").replace(/\'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")},decodeData:function(r){try{return decodeURIComponent(r).replace(/\%21/g,"!").replace(/\%7E/g,"~").replace(/\%2A/g,"*").replace(/\%27/g,"'").replace(/\%28/g,"(").replace(/\%29/g,")")}catch(e){try{return unescape(r)}catch(e){return""}}},set:function(e,r,t,a,n){var t=t?((s=new Date).setTime(s.getTime()+60*t*1e3),"; expires="+s.toGMTString()):"",s=a&&!n?";domain=."+a:"";document.cookie=this.encodeData(e)+"="+this.encodeData(r)+t+s+"; path=/"},get:function(e){for(var r=this.encodeData(e)+"=",t=document.cookie.split(";"),a=0;a<t.length;a++){for(var n=t[a];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(r))return this.decodeData(n.substring(r.length,n.length))}return null},destroy:function(e,r,t){this.set(e,"",-1,r,t)},parse:function(e){var r=[],t={};if("string"==typeof e)r.push(e);else for(var a in e)e.hasOwnProperty(a)&&r.push(e[a]);for(var n=0;n<r.length;n++){t[this.unsbjs(r[n])]={};for(var s=this.get(r[n])?this.get(r[n]).split(u):[],i=0;i<s.length;i++){var o=s[i].split("="),c=o.splice(0,1);c.push(o.join("=")),t[this.unsbjs(r[n])][c[0]]=this.decodeData(c[1])}}return t},unsbjs:function(e){return e.replace("sbjs_","")}}},{"../data":2}],4:[function(e,r){r.exports={parse:function(e){for(var a=this.parseOptions,r=a.parser[a.strictMode?"strict":"loose"].exec(e),n={},t=14;t--;)n[a.key[t]]=r[t]||"";return n[a.q.name]={},n[a.key[12]].replace(a.q.parser,function(e,r,t){r&&(n[a.q.name][r]=t)}),n},parseOptions:{strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},getParam:function(e){for(var r={},t=(e||window.location.search.substring(1)).split("&"),a=0;a<t.length;a++){var n,s=t[a].split("=");void 0===r[s[0]]?r[s[0]]=s[1]:"string"==typeof r[s[0]]?(n=[r[s[0]],s[1]],r[s[0]]=n):r[s[0]].push(s[1])}return r},getHost:function(e){return this.parse(e).host.replace("www.","")}}},{}],5:[function(e,r){r.exports={escapeRegexp:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},setDate:function(e,r){var t=e.getTimezoneOffset()/60,a=e.getHours();return e.setHours(a+t+(r||-t)),e.getFullYear()+"-"+this.setLeadingZeroToInt(e.getMonth()+1,2)+"-"+this.setLeadingZeroToInt(e.getDate(),2)+" "+this.setLeadingZeroToInt(e.getHours(),2)+":"+this.setLeadingZeroToInt(e.getMinutes(),2)+":"+this.setLeadingZeroToInt(e.getSeconds(),2)},setLeadingZeroToInt:function(e,r){for(var t=e+"";t.length<r;)t="0"+t;return t},randomInt:function(e,r){return Math.floor(Math.random()*(r-e+1))+e}}},{}],6:[function(e,r){var v=e("./data"),_=e("./terms"),x=e("./helpers/cookies"),b=e("./helpers/uri"),k=e("./helpers/utils"),w=e("./params"),q=e("./migrations");r.exports=function(e){function r(e){switch(e){case _.traffic.utm:s=_.traffic.utm,i=void 0!==g.utm_source?g.utm_source:void 0!==g.gclid?"google":_.none,o=void 0!==g.utm_medium?g.utm_medium:void 0!==g.gclid?"cpc":_.none,c=void 0!==g.utm_campaign?g.utm_campaign:void 0!==g[l.campaign_param]?g[l.campaign_param]:void 0!==g.gclid?"google_cpc":_.none,u=g.utm_content||_.none,p=(()=>{var e=document.referrer;if(g.utm_term)return g.utm_term;if(!(e&&b.parse(e).host&&b.parse(e).host.match(/^(?:.*\.)?yandex\..{2,9}$/i)))return!1;try{return b.getParam(b.parse(document.referrer).query).text}catch(e){return!1}})()||_.none;break;case _.traffic.organic:s=_.traffic.organic,i=i||b.getHost(document.referrer),o=_.referer.organic,c=_.none,u=_.none,p=_.none;break;case _.traffic.referral:s=_.traffic.referral,i=i||b.getHost(document.referrer),o=o||_.referer.referral,c=_.none,u=b.parse(document.referrer).path,p=_.none;break;case _.traffic.typein:s=_.traffic.typein,i=l.typein_attributes.source,o=l.typein_attributes.medium,c=_.none,u=_.none,p=_.none;break;default:s=_.oops,i=_.oops,o=_.oops,c=_.oops,u=_.oops,p=_.oops}e={type:s,source:i,medium:o,campaign:c,content:u,term:p};return v.pack.main(e)}function t(e){var r=document.referrer;switch(e){case _.traffic.organic:return r&&a(r)&&(e=>{var r=new RegExp("^(?:.*\\.)?"+k.escapeRegexp("yandex")+"\\..{2,9}$"),t=new RegExp(".*"+k.escapeRegexp("text")+"=.*"),a=new RegExp("^(?:www\\.)?"+k.escapeRegexp("google")+"\\..{2,9}$");if(b.parse(e).query&&b.parse(e).host.match(r)&&b.parse(e).query.match(t))return i="yandex";if(b.parse(e).host.match(a))return i="google";if(b.parse(e).query)for(var n=0;n<l.organics.length;n++){if(b.parse(e).host.match(new RegExp("^(?:.*\\.)?"+k.escapeRegexp(l.organics[n].host)+"$","i"))&&b.parse(e).query.match(new RegExp(".*"+k.escapeRegexp(l.organics[n].param)+"=.*","i")))return i=l.organics[n].display||l.organics[n].host,1;if(n+1===l.organics.length)return}})(r);case _.traffic.referral:return r&&a(r)&&(e=>{if(!(0<l.referrals.length))return i=b.getHost(e),1;for(var r=0;r<l.referrals.length;r++){if(b.parse(e).host.match(new RegExp("^(?:.*\\.)?"+k.escapeRegexp(l.referrals[r].host)+"$","i")))return i=l.referrals[r].display||l.referrals[r].host,o=l.referrals[r].medium||_.referer.referral,1;if(r+1===l.referrals.length)return i=b.getHost(e),1}})(r);default:return}}function a(e){var r;return l.domain?h?b.getHost(e)!==b.getHost(d):(r=new RegExp("^(?:.*\\.)?"+k.escapeRegexp(d)+"$","i"),!b.getHost(e).match(r)):b.getHost(e)!==b.getHost(document.location.href)}function n(){x.set(v.containers.current_extra,v.pack.extra(l.timezone_offset),y,d,h),x.get(v.containers.first_extra)||x.set(v.containers.first_extra,v.pack.extra(l.timezone_offset),y,d,h)}var s,i,o,c,u,p,f,m,l=w.fetch(e),g=b.getParam(),d=l.domain.host,h=l.domain.isolate,y=l.lifetime;return q.go(y,d,h),x.set(v.containers.current,(()=>{var e;if(void 0!==g.utm_source||void 0!==g.utm_medium||void 0!==g.utm_campaign||void 0!==g.utm_content||void 0!==g.utm_term||void 0!==g.gclid||void 0!==g[l.campaign_param])n(),e=r(_.traffic.utm);else if(t(_.traffic.organic))n(),e=r(_.traffic.organic);else if(!x.get(v.containers.session)&&t(_.traffic.referral))n(),e=r(_.traffic.referral);else{if(x.get(v.containers.first)||x.get(v.containers.current))return x.get(v.containers.current);n(),e=r(_.traffic.typein)}return e})(),y,d,h),x.get(v.containers.first)||x.set(v.containers.first,x.get(v.containers.current),y,d,h),f=(f=x.get(v.containers.udata)?(f=parseInt(x.parse(v.containers.udata)[x.unsbjs(v.containers.udata)][v.aliases.udata.visits])||1,x.get(v.containers.session)?f:f+1):1,v.pack.user(f,l.user_ip)),x.set(v.containers.udata,f,y,d,h),x.get(v.containers.session)?(m=parseInt(x.parse(v.containers.session)[x.unsbjs(v.containers.session)][v.aliases.session.pages_seen])||1,m+=1):m=1,x.set(v.containers.session,v.pack.session(m),l.session_length,d,h),l.promocode&&!x.get(v.containers.promocode)&&x.set(v.containers.promocode,v.pack.promo(l.promocode),y,d,h),x.parse(v.containers)}},{"./data":2,"./helpers/cookies":3,"./helpers/uri":4,"./helpers/utils":5,"./migrations":7,"./params":8,"./terms":9}],7:[function(e,r){var c=e("./data"),u=e("./helpers/cookies");r.exports={go:function(e,r,t){var a=this.migrations,n={l:e,d:r,i:t};if(u.get(c.containers.first)||u.get(c.service.migrations)){if(!u.get(c.service.migrations))for(i=0;i<a.length;i++)a[i].go(a[i].id,n)}else{for(var s=[],i=0;i<a.length;i++)s.push(a[i].id);var o="";for(i=0;i<s.length;i++)o+=s[i]+"=1",i<s.length-1&&(o+=c.delimiter);u.set(c.service.migrations,o,n.l,n.d,n.i)}},migrations:[{id:"1418474375998",version:"1.0.0-beta",go:function(r,t){function e(e,r,t){return r||t?e:c.delimiter}var a=r+"=1",r=r+"=0";try{var n,s=[];for(n in c.containers)c.containers.hasOwnProperty(n)&&s.push(c.containers[n]);for(var i,o=0;o<s.length;o++)u.get(s[o])&&(i=u.get(s[o]).replace(/(\|)?\|(\|)?/g,e),u.destroy(s[o],t.d,t.i),u.destroy(s[o],t.d,!t.i),u.set(s[o],i,t.l,t.d,t.i));u.get(c.containers.session)&&u.set(c.containers.session,c.pack.session(0),t.l,t.d,t.i),u.set(c.service.migrations,a,t.l,t.d,t.i)}catch(e){u.set(c.service.migrations,r,t.l,t.d,t.i)}}}]}},{"./data":2,"./helpers/cookies":3}],8:[function(e,r){var s=e("./terms"),i=e("./helpers/uri");r.exports={fetch:function(e){var r=e||{},t={};if(t.lifetime=this.validate.checkFloat(r.lifetime)||6,t.lifetime=parseInt(30*t.lifetime*24*60),t.session_length=this.validate.checkInt(r.session_length)||30,t.timezone_offset=this.validate.checkInt(r.timezone_offset),t.campaign_param=r.campaign_param||!1,t.user_ip=r.user_ip||s.none,r.promocode?(t.promocode={},t.promocode.min=parseInt(r.promocode.min)||1e5,t.promocode.max=parseInt(r.promocode.max)||999999):t.promocode=!1,r.typein_attributes&&r.typein_attributes.source&&r.typein_attributes.medium?(t.typein_attributes={},t.typein_attributes.source=r.typein_attributes.source,t.typein_attributes.medium=r.typein_attributes.medium):t.typein_attributes={source:"(direct)",medium:"(none)"},t.domain=r.domain&&this.validate.isString(r.domain)?{host:r.domain,isolate:!1}:r.domain&&r.domain.host?r.domain:{host:i.getHost(document.location.hostname),isolate:!1},t.referrals=[],r.referrals&&0<r.referrals.length)for(var a=0;a<r.referrals.length;a++)r.referrals[a].host&&t.referrals.push(r.referrals[a]);if(t.organics=[],r.organics&&0<r.organics.length)for(var n=0;n<r.organics.length;n++)r.organics[n].host&&r.organics[n].param&&t.organics.push(r.organics[n]);return t.organics.push({host:"bing.com",param:"q",display:"bing"}),t.organics.push({host:"yahoo.com",param:"p",display:"yahoo"}),t.organics.push({host:"about.com",param:"q",display:"about"}),t.organics.push({host:"aol.com",param:"q",display:"aol"}),t.organics.push({host:"ask.com",param:"q",display:"ask"}),t.organics.push({host:"globososo.com",param:"q",display:"globo"}),t.organics.push({host:"go.mail.ru",param:"q",display:"go.mail.ru"}),t.organics.push({host:"rambler.ru",param:"query",display:"rambler"}),t.organics.push({host:"tut.by",param:"query",display:"tut.by"}),t.referrals.push({host:"t.co",display:"twitter.com"}),t.referrals.push({host:"plus.url.google.com",display:"plus.google.com"}),t},validate:{checkFloat:function(e){return!(!e||!this.isNumeric(parseFloat(e)))&&parseFloat(e)},checkInt:function(e){return!(!e||!this.isNumeric(parseInt(e)))&&parseInt(e)},isNumeric:function(e){return!isNaN(e)},isString:function(e){return"[object String]"===Object.prototype.toString.call(e)}}}},{"./helpers/uri":4,"./terms":9}],9:[function(e,r){r.exports={traffic:{utm:"utm",organic:"organic",referral:"referral",typein:"typein"},referer:{referral:"referral",organic:"organic",social:"social"},none:"(none)",oops:"(Houston, we have a problem)"}},{}]},{},[1])(1)});
//# sourceMappingURL=sourcebuster.min.js.map
